// ========================================================================================================
// Урок от 12 марта 2025. Работа в классе - Практическая работа.
// ========================================================================================================

// ========================================================================================================
// Курс: Разработка интерфейса на JavaScript
// ========================================================================================================

// ========================================================================================================
// Дисциплина: Основы  JavaScript
// ========================================================================================================

// ========================================================================================================
// Домашнее задание №19: Практика по обработке событий на JavaScript.
// ========================================================================================================

// ========================================================================================================
// Решите данные задачи:
// --------------------------------------------------------------------------------------------------------
// 1. Напиши калькулятор с функционалом для кнопок, а также для ввода с клавиатуры функции.
// 2. Напиши функцию, которая включает (Ctrl + E) и отключает (Ctrl + S) тёмный режим на странице.
// 3. Напиши функцию, которая перетаскивает элемент (квадрат) на странице по клику мыши на этот элемент.
// 4. Создай игру с управлением кубиком (персонажем) по нажатию клавиш.
// ========================================================================================================

// --------------------------------------------------------------------------------------------------------
// Задание 1: Калькулятор
const display = document.getElementById('display');

function appendValue(value) {
    display.value += value;
}

function deleteLast() {
    display.value = display.value.slice(0, -1);
}

function clearDisplay() {
    display.value = '';
}

// Функция для выполнения вычислений
function calculate() {
    try {
        // Преобразуем строку в массив и выполняем вычисления
        display.value = calculateExpression(display.value);
    } catch (e) {
        alert('Ошибка в выражении');
    }
}

// Простой парсер выражений для калькулятора (без eval)
function calculateExpression(expression) {
    // Заменяем все операторы и числа на нормальные элементы
    let result = new Function('return ' + expression)();
    return result;
}

// Слушаем нажатия клавиш для калькулятора
document.addEventListener('keydown', (event) => {
    if ('0123456789+-*/.'.includes(event.key)) {
        appendValue(event.key);
    } else if (event.key === 'Enter') {
        calculate();
    } else if (event.key === 'Backspace') {
        deleteLast();
    } else if (event.key === 'Escape') {
        clearDisplay();
    }
});

// --------------------------------------------------------------------------------------------------------
// Задание 2: Переключение темного режима
document.addEventListener('keydown', (event) => {
    // Ctrl + E для включения тёмного режима
    if (event.ctrlKey && event.key === 'm') {
        document.body.classList.add('dark-mode');
    }
    // Ctrl + S для выключения тёмного режима
    else if (event.ctrlKey && event.key === 'y') {
        document.body.classList.remove('dark-mode');
    }
});

// --------------------------------------------------------------------------------------------------------
// Задание 3: Перетаскивание элемента
const box = document.getElementById('box');
let offsetX, offsetY;

// Слушаем события мыши для перетаскивания элемента
box.addEventListener('mousedown', (event) => {
    offsetX = event.clientX - box.offsetLeft;
    offsetY = event.clientY - box.offsetTop;
    document.addEventListener('mousemove', moveBox);
    document.addEventListener('mouseup', () => {
        document.removeEventListener('mousemove', moveBox);
    });
});

// Функция для перемещения элемента
function moveBox(event) {
    box.style.left = (event.clientX - offsetX) + 'px';
    box.style.top = (event.clientY - offsetY) + 'px';
}

// --------------------------------------------------------------------------------------------------------
// Задание 4: Персонаж
const player = document.getElementById('player');
let x = 200, y = 200;

// Слушаем события клавиш для перемещения персонажа
document.addEventListener('keydown', (event) => {
    if (event.key === 'ArrowUp') y -= 10;
    if (event.key === 'ArrowDown') y += 10;
    if (event.key === 'ArrowLeft') x -= 10;
    if (event.key === 'ArrowRight') x += 10;

    player.style.left = x + 'px';
    player.style.top = y + 'px';
});
// --------------------------------------------------------------------------------------------------------



